#!/bin/bash
echo "Patch Script For CVE-2021-3156"
echo "`whoami`, NEED TO BE A SUDOER."
echo "Warning! Make Sure to have a backup first before proceeding. CTRL+X to exit."
sleep 15
echo ""

echo -e "Downloading Latest Version..\n"
#check if already downloaded
FILENAME=$(ls | grep sudo-1.9.5p2.tar.gz)
if [ -z $FILENAME ]; then

     wget https://www.sudo.ws/dist/sudo-1.9.5p2.tar.gz --show-progress
        FILENAME=$(ls | grep sudo-1.9.5p2.tar.gz)
        if [ -z $FILENAME ]; then
            echo "Download Failed.. \n"
            exit
        fi
fi

tar xzvf $FILENAME
cd sudo-1.9.5p2
echo ""
./configure
echo ""
make && sudo make install

echo "-------------------------------------------------------"
if bash -c "sudo --version" | grep -q '1.9.5p2'; then
   echo "Succesffully Patched!"
else
   echo "Failure! PATCHING FAILED."
fi

echo "-------------------------------------------------------"
sleep 3
cd ..
rm $FILENAME
rm ./sudo-1.9.5p2 -rf

